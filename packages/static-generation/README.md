# Static Site Generation

-   [Introduction](#introduction)
-   [Details](#details)
    -   [Project Setup](#project-setup)
    -   [Content Templates](#content-templates)
    -   [Generating a Static Site](#generating-a-static-site)
    -   [CLI](#cli)
    -   [Configuration](#configuration)
-   [Recipe Setup](#recipe-setup)

## Introduction

This recipe serves a statically generated site that renders all possible routes for the LWR app at build time.

## Details

### Project Setup

```
src/
  ├── assets/        // static resources
  │   └── css/
  │   └── images/
  ├── content/       // page content templates
  ├── data/          // global template context data
  │   └── site/
  │   └── global.json
  ├── hooks/         // programmatic app configuration
  │   └── config.ts
  ├── layouts/       // layout templates
  │   └── partials/
  │   └── main_layout.njk
  └── modules/
lwr.config.json
package.json
```

### Content Templates

Static generation can render _.html_, _.md_, and _.njk_ files. By default, page content templates go in the _content/_ folder and layouts go in the _layouts/_ folder.

> This recipe also uses a configuration hook and global data. Read more in the [templating recipe](https://github.com/salesforce/lwr-recipes/tree/main/packages/templating).

### Generating a Static Site

You can statically generate your site using the `generateStaticSite()` function.

It takes an optional `LwrGlobalConfig` object, which has the same format as the configuration in _lwr.config.json_. Before generating the static site, the configurations are merged, with the passed object taking precedence.

> See the LWR configuration doc [here](https://github.com/salesforce/lwr-recipes/blob/main/doc/config.md).

```typescript
// my-app/src/scripts.generate.js

generateStaticSite({
    serverMode,
    staticSiteGenerator: {
        outputDir: `__generated_site_${serverMode}__`,
    },
})
    .then((data) => {
        console.log('>> success', data);
        process.exit(0);
    })
    .catch((err) => {
        console.error('>> failed', err);
        process.exit(1);
    });
```

### CLI

This recipe uses the LWR `static-build` command to generate the static site:

```json
// my-app/package.json
"scripts": {
    "build:static": "lwr static-build --outputDir __generated_site__"
},
```

This CLI script uses the `staticSiteGenerator` configuration from _lwr.config.json_. The `outputDir` CLI option is not required.

### Configuration

Learn more in [Configure a LWR Project](https://github.com/salesforce/lwr-recipes/blob/main/doc/config.md).

The LWR static site generation configuration contains these properties:

```typescript
interface StaticSiteGenerator {
    outputDir?: string; // optional, default is "__generated_site__"
    locales?: string[]; // optional, default is ['en-US']
    _additionalRoutePaths?: string[]; // optional, default is []
}
```

#### Parameterized Route Configuration

Parameterized routes (i.e. "/item/:id") are not statically generated by default However, they can be declared in `staticSiteGenerator._additionalRoutePaths`:

```json
// my-app/lwr.config.json
"staticSiteGenerator": {
    "outputDir": "my_generated_site",
    "locales": ["en-US", "es", "de", "fr"],
    "_additionalRoutePaths": ["/item/1", "/item/2"]
}
```

## Recipe Setup

To build and run:

```bash
# from the lwr-recipes root
yarn install
cd packages/static-generation
yarn build:static # statically generate the app
yarn start:static # run the app
```

Open the static site at [http://localhost:3000](http://localhost:3000)

To build and run without static generation:

```bash
# from the lwr-recipes root
yarn install
cd packages/static-generation
yarn start
```

Open the live site at [http://localhost:3000](http://localhost:3000)

See documentation for all commands [here](https://github.com/salesforce/lwr-recipes/blob/master/doc/get_started.md).
